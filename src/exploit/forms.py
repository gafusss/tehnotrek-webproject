# coding=utf-8
from django import forms
from .models import Post, ExploitType, Like
import re


class PostForm(forms.ModelForm):
    class Meta:
        model = Post
        fields = ('title', 'cve_id', 'code', 'description', 'attachment_file', 'exploit_type', 'platform')

    def clean_cve_id(self):
        cve_id = self.cleaned_data.get('cve_id')
        cve_regexp = re.compile('^[0-9]{4}-[0-9]{4}$')
        if not cve_regexp.match(cve_id):
            raise forms.ValidationError(u'Неверный формат CVE-ID')
        return cve_id


class PostListForm(forms.Form):
    search = forms.CharField(label=u'Название', required=False,
                             widget=forms.TextInput(attrs={'placeholder': u'Название'}))
    sort = forms.ChoiceField(label=u'Сортировка',
                             choices=(('id', "ID"), ('published', "Дата публикации"), ('title', "Название")),
                             required=False)
    reverse = forms.BooleanField(required=False, label=u'Обратный порядок')
    confirmed_only = forms.BooleanField(required=False, label=u'Только подтверждённые')
    exploittype = forms.ModelChoiceField(queryset=ExploitType.objects.all(), required=False, label=u'Тип эксплоита')