function reply(id) {
    document.getElementById("input-comment-new-parent-comment").value = id;

    var replyForm = document.getElementById("form-comment-new");

    try {
        replyForm.removeChild(document.getElementById("section-comment-reply-preview"));
    } catch (e) {

    }

    var replyTo = document.getElementById("article-comment-" + id).cloneNode(true);

    replyTo.id = "article-comment-reply-to";

    var repliesToDelete = replyTo.getElementsByClassName("section-comment-replies")[0];
    if (repliesToDelete) {
        replyTo.removeChild(repliesToDelete);
    }
    replyTo.firstElementChild.firstElementChild.removeChild(replyTo.getElementsByClassName("a-comment-reply")[0]);

    var section = document.createElement("section");
    section.id = "section-comment-reply-preview";
    section.appendChild(document.createTextNode("В ответ на: "));
    section.appendChild(replyTo);

    var clearButton = document.createElement("a");
    clearButton.id = "a-comment-new-clear";
    clearButton.href = location.pathname + "#form-comment-new";
    clearButton.onclick = function () {
        commentClearReplyTo();
        return false;
    };
    clearButton.appendChild(document.createTextNode("Очистить"));

    section.appendChild(clearButton);

    replyForm.insertBefore(section, document.getElementById("textarea-comment-new"));

    location.hash = "";
    location.hash = "#form-comment-new";
}

function commentClearReplyTo() {
    document.getElementById("input-comment-new-parent-comment").value = null;

    var replyForm = document.getElementById("form-comment-new");

    try {
        replyForm.removeChild(document.getElementById("section-comment-reply-preview"));
    } catch (e) {
    }
}

function sendComment(url) {
    var xhr = new XMLHttpRequest();
    xhr.open('POST', url, true);
    xhr.onreadystatechange = function () {
        if (xhr.readyState == 4) {
            if (xhr.status == 200) {
                var response = JSON.parse(xhr.responseText);
                document.getElementById("section-comments").innerHTML = response.data;
                location.hash = "";
                location.hash = "#article-comment-" + response.id;
            }
        }
    };
    //xhr.setRequestHeader("X-CSRFToken", getCookie('csrftoken'));
    var formData = new FormData(document.forms.newcomment);
    xhr.send(formData);
}
